<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/styles/librarian-role.css">
    <link rel="stylesheet" href="/styles/book-detail.css" />
    <link rel="stylesheet" href="/styles/footer.css"/>
    <link rel="stylesheet" href="/styles/customer.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Document</title>
</head>
<body>
    <%- include('./partials-librarian/nav-librarian.ejs')%>
    <%- include('../book/book_detail.ejs')%>
    <!-- <% if (book) { %>
        <h2><%= book.title %></h2>
        <p>Author: <%= book.author %></p>
        <p>Category: <%= book.category.join(', ') %></p>
        <p>Description: <%= book.description %></p>
        <p>Publish Date: <%= book.publishDate.toDateString() %></p>
        <p>Number of Books: <%= book.amount %></p>
        <p>Available books: <%= book.available %></p>

        <label>Categories:</label>
        <% book.category.forEach(category => { %>
            <label>
                <%= category %>
            </label>
        <% }); %>

    <% } else { %>
        <p>Book not found</p>
    <% } %> -->

    <!-- Button to toggle the form visibility -->
    <!-- <button id="editButton">Edit Book</button>
    <form method="POST" action="/librarian/book_detail/delete/<%= book._id %>" onsubmit="return confirm('Are you sure you want to delete this book?');">
        <button type="submit">Delete</button>
    </form> -->

    <!-- Form to edit book (initially hidden) -->
    <form id="editForm" class="centered-form" style="display:none;" action="/librarian/book_detail/<%= book._id %>" method="post" enctype="multipart/form-data">
        <label for="title">Title:</label>
        <input type="text" name="title" value="<%= book.title %>" required>

        <label for="author">Author:</label>
        <input type="text" name="author" value="<%= book.author %>" required>

        <label>Categories:</label>
        <% categories.forEach(category => { %>
            <label>
                <input type="checkbox" name="category" id="category" value="<%= category %>" <%= book.category.includes(category) ? 'checked' : '' %>>
                <%= category %>
            </label>
        <% }); %>

        <label for="description">Description:</label>
        <textarea name="description" rows="4" required><%= book.description %></textarea>

        <label for="amount">Amount:</label>
        <input type="number" name="amount" id="amountInput" value=<%= book.amount %> min="0" required>

        <label for="available">Available:</label>
        <input type="number" name="available" value=<%= book.available %> min="0" required>

        <label for="cover_1">Cover Image 1:</label>
        <input type="file" name="cover_1" accept="image/*">

        <label for="cover_2">Cover Image 2:</label>
        <input type="file" name="cover_2" accept="image/*">

        <label for="cover_3">Cover Image 3:</label>
        <input type="file" name="cover_3" accept="image/*">

        <button type="submit">Save Changes</button>
    </form>
    <%- include("../partials_readers/footer.ejs") %>
    <script>
        document.getElementById('editButton').addEventListener('click', function() {
            document.getElementById('editForm').style.display = 'block';
        });

        // Enforce amount can not be smaller than available
        document.getElementById('amountInput').addEventListener('input', function() {
            var amountInput = this;
            var availableInput = document.getElementsByName('available')[0];
            var maxAmount = parseInt(availableInput.value);

            // Validate and update the input value
            if (parseInt(amountInput.value) < maxAmount) {
                amountInput.value = maxAmount;
            }
        });

        // Enforce available can not be alrger than amount
        document.getElementsByName('available')[0].addEventListener('input', function() {
            var availableInput = this;
            var amountInput = document.getElementById('amountInput');
            var maxAvailable = parseInt(amountInput.value);

            // Validate and update the input value
            if (parseInt(availableInput.value) > maxAvailable) {
                availableInput.value = maxAvailable;
            }
        });

    </script>
    <!-- CSS to center the form -->
    <style>
        .centered-form {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
    </style>
    <script src="/js/librarian-role.js"></script>
    <!-- Add borrow button -->
</body>
</html>